<!DOCTYPE html><html lang="en" > <!-- The Head v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Dubbo文档阅读笔记-设计 | 黄玉才的博客</title><meta name="generator" content="Jekyll v4.1.1" /><meta property="og:title" content="Dubbo文档阅读笔记-设计" /><meta name="author" content="Kol Huang" /><meta property="og:locale" content="en_US" /><meta name="description" content="整体设计" /><meta property="og:description" content="整体设计" /><link rel="canonical" href="www.yucaihuang.com/posts/dubbo-doc-2/" /><meta property="og:url" content="www.yucaihuang.com/posts/dubbo-doc-2/" /><meta property="og:site_name" content="黄玉才的博客" /><meta property="og:image" content="https://hyc-pic.oss-cn-hangzhou.aliyuncs.com/leetcode_cover.jpg" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-06-08T14:36:00+08:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://hyc-pic.oss-cn-hangzhou.aliyuncs.com/leetcode_cover.jpg" /><meta property="twitter:title" content="Dubbo文档阅读笔记-设计" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@Kol Huang" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"image":"https://hyc-pic.oss-cn-hangzhou.aliyuncs.com/leetcode_cover.jpg","mainEntityOfPage":{"@type":"WebPage","@id":"www.yucaihuang.com/posts/dubbo-doc-2/"},"url":"www.yucaihuang.com/posts/dubbo-doc-2/","author":{"@type":"Person","name":"Kol Huang"},"description":"整体设计","dateModified":"2021-06-08T14:36:00+08:00","datePublished":"2021-06-08T14:36:00+08:00","headline":"Dubbo文档阅读笔记-设计","@type":"BlogPosting","@context":"https://schema.org"}</script> <!-- The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps Generated by: https://www.favicon-generator.org/ v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT license --><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="preload" as="style" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"> <!-- CSS selector for site. Chirpy v2.3 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT Licensed --><link rel="preload" as="style" href="/assets/css/post.css"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /><link rel="preload" as="script" href="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"> <script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" async></script> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-176388509-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-176388509-1'); </script> <!-- JS selector for site. Chirpy v2.3 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT Licensed --> <script src="/assets/js/post.min.js" async></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" async></script> <script src="/app.js" defer></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"> <!-- The Side Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="http://www.yucaihuang.com" alt="avatar"> <img src="/assets/img/daliy/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="profile-text mt-3"><div class="site-title"> <a href="/">黄玉才的博客</a></div><div class="site-subtitle font-italic">Focus!</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></li></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <span id="mode-toggle-wrapper"> <!-- Switch the mode between dark and light. v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <i class="mode-toggle fas fa-sun" dark-mode-invisible></i> <i class="mode-toggle fas fa-moon" light-mode-invisible></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.mode != null) { if (this.mode == ModeToggle.DARK_MODE) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.mode != null) { if (self.mode == ModeToggle.DARK_MODE) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightkMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightkMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span> <span class="icon-border"></span> <a href="https://github.com/KolinHuang" target="_blank"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/twitter_username" target="_blank"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:window.open('mailto:' + ['yc_huang97','163.com'].join('@'))" > <i class="fas fa-envelope"></i> </a></div></div><!-- The Top Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Dubbo文档阅读笔记-设计</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"> <!-- Refactor the HTML structure. --> <!-- Suroundding the markdown table with '<div class="table-wrapper">. and '</div>' --> <!-- Fixed kramdown code highlight rendering: https://github.com/penibelst/jekyll-compress-html/issues/101 https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901 --><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Dubbo文档阅读笔记-设计</h1><div class="post-meta text-muted d-flex flex-column"><div> Posted <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Tue, Jun 8, 2021, 2:36 PM +0800" > Jun 8 <i class="unloaded">2021-06-08T14:36:00+08:00</i> </span> by <span class="author"> Kol Huang</div></div><div class="post-content"> <img src="https://hyc-pic.oss-cn-hangzhou.aliyuncs.com/leetcode_cover.jpg" class="post-preview-img"><h2 id="整体设计">整体设计</h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://hyc-pic.oss-cn-hangzhou.aliyuncs.com/image-20210607094141614.png" alt="image-20210607094141614" style="zoom:200%;" /></p><p>上图中，左边淡蓝色背景为服务消费方提供的接口，右边淡绿色背景为服务提供方使用的接口，位于中轴线上的是双方都会用到的接口。</p><ul><li>图中从下至上分为十层，各层均为单向依赖，右边的黑色箭头代表层之间的依赖关系，每一层都可以剥离上层被复用，其中，Service 和 Config 层为 API，其它各层均为 SPI。</li><li>图中绿色小块的为扩展接口，蓝色小块为实现类，图中只显示用于关联各层的实现类。</li><li>图中蓝色虚线为初始化过程，即启动时组装链，红色实线为方法调用过程，即运行时调时链，紫色三角箭头为继承，可以把子类看作父类的同一个节点，线上的文字为调用的方法。</li></ul><p><strong>各层说明：</strong></p><ul><li>config配置层，<strong>对外配置接口</strong>，以ServiceConfig、ReferenceConfig为中心，可以直接初始化配置类，也可以通过Spring解析配置生成配置类。</li><li>proxy服务代理层：<strong>服务接口透明代理</strong>，生成服务的客户端Stub和服务端Skeleton，以ServiceProxy为中心，扩展接口为ProxyFactory</li><li>registry注册中心层：封装<strong>服务地址的注册与发现</strong>，以服务URL为中心，扩展接口为RegistryFactory，Registry，RegistryService</li><li>Cluster路由层：封装多个提供者的路由及<strong>负载均衡</strong>，并桥接注册中心，以Invoker为中心，扩展接口为Cluster、Directory，Router，LoadBalance。</li><li>Monitor监控层：<strong>RPC调用次数和调用时间监控</strong>，以Statistics为中心，扩展接口为MonitorFactory，Monitor，MonitorService。</li><li>Protocol远程调用层：<strong>封装RPC调用</strong>，以Invocation，Result为中心，扩展接口为Protocol，Invoker，Exporter。</li><li>Exchange信息交换层：<strong>封装请求响应模式，同步转异步</strong>，以Request，Response为中心，扩展接口为Exchanger，ExchangeChannel，ExchangeClient，ExchangeServer。</li><li>Transport网络传输层：<strong>抽象Mina和Netty为统一接口</strong>，以Message为中心，扩展接口为Channel，Transporter，Client，Server，Codec</li><li>Serialize数据序列化层：<strong>可复用的一些工具</strong>，扩展接口为Serialization，ObjectInput，ObjectOutput，ThreadPool</li></ul><p><strong>关系说明：</strong></p><ul><li>在 RPC 中，Protocol 是核心层，也就是<strong>只要有 Protocol + Invoker + Exporter 就可以完成非透明的 RPC 调用</strong>，然后在 Invoker 的主过程上 Filter 拦截点。</li><li>Cluster 是外围概念，所以 Cluster 的目的<strong>是将多个 Invoker 伪装成一个 Invoker</strong>，这样其它人只要关注 Protocol 层 Invoker 即可，加上 Cluster 或者去掉 Cluster 对其它层都不会造成影响，因为只有一个提供者时，是不需要 Cluster 的。</li><li>Proxy 层<strong>封装了所有接口的透明化代理</strong>，而在其它层<strong>都以 Invoker 为中心</strong>，只有到了暴露给用户使用时，才用 Proxy 将 Invoker 转成接口，或将接口实现转成 Invoker，也就是去掉 Proxy 层 RPC 是可以 Run 的，只是不那么透明，不那么看起来像调本地服务一样调远程服务。</li><li>而 Remoting 实现是 Dubbo 协议的实现，如果你选择 RMI 协议，整个 Remoting 都不会用上，Remoting 内部再划为 Transport 传输层和 Exchange 信息交换层，<strong>Transport 层只负责单向消息传输，是对 Mina, Netty, Grizzly 的抽象，它也可以扩展 UDP 传输，而 Exchange 层是在传输层之上封装了 Request-Response 语义。</strong></li><li>Registry 和 Monitor 实际上不算一层，而是一个独立的节点，只是为了全局概览，用层的方式画在一起。</li></ul><p><strong>模块说明：</strong></p><ul><li><strong>dubbo-common 公共逻辑模块</strong>：包括 Util 类和通用模型。</li><li><strong>dubbo-remoting 远程通讯模块</strong>：相当于 Dubbo 协议的实现，如果 RPC 用 RMI协议则不需要使用此包。</li><li><strong>dubbo-rpc 远程调用模块</strong>：抽象各种协议，以及动态代理，只包含一对一的调用，不关心集群的管理。</li><li><strong>dubbo-cluster 集群模块</strong>：将多个服务提供方伪装为一个提供方，包括：负载均衡, 容错，路由等，集群的地址列表可以是静态配置的，也可以是由注册中心下发。</li><li><strong>dubbo-registry 注册中心模块</strong>：基于注册中心下发地址的集群方式，以及对各种注册中心的抽象。</li><li><strong>dubbo-monitor 监控模块</strong>：统计服务调用次数，调用时间的，调用链跟踪的服务。</li><li><strong>dubbo-config 配置模块</strong>：是 Dubbo 对外的 API，用户通过 Config 使用Dubbo，隐藏 Dubbo 所有细节。</li><li><strong>dubbo-container 容器模块</strong>：是一个 Standlone 的容器，以简单的 Main 加载 Spring 启动，因为服务通常不需要 Tomcat/JBoss 等 Web 容器的特性，<strong>没必要用 Web 容器去加载服务。</strong></li></ul><p><strong>调用链：</strong></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://hyc-pic.oss-cn-hangzhou.aliyuncs.com/image-20210607104753972.png" alt="image-20210607104753972" /></p><p><strong>服务暴露时序：</strong></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://hyc-pic.oss-cn-hangzhou.aliyuncs.com/image-20210607104833391.png" alt="image-20210607104833391" /></p><p><strong>服务引用时序：</strong></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://hyc-pic.oss-cn-hangzhou.aliyuncs.com/image-20210607104851597.png" alt="image-20210607104851597" /></p><p>在 Dubbo 的核心领域模型中：</p><ul><li>Protocol 是服务域，它是 <strong>Invoker 暴露和引用的主功能入口，它负责 Invoker 的生命周期管理</strong>。</li><li>Invoker 是实体域，它是 Dubbo 的核心模型，其它模型都向它靠扰，或转换成它，<strong>它代表一个可执行体</strong>，可向它发起 invoke 调用，它有可能是一个本地的实现，也可能是一个远程的实现，也可能一个集群实现。</li><li>Invocation 是会话域，<strong>它持有调用过程中的变量</strong>，比如方法名，参数等。</li></ul><p><strong>基本设计原则：</strong></p><ul><li>采用 Microkernel + Plugin 模式，Microkernel 只负责组装 Plugin，Dubbo 自身的功能也是通过扩展点实现的，也就是 Dubbo 的所有功能点都可被用户自定义扩展所替换。</li><li>采用 URL 作为配置信息的统一格式，所有扩展点都通过传递 URL 携带配置信息。</li></ul><h2 id="扩展点加载">扩展点加载</h2><p>Dubbo 的扩展点加载从 JDK 标准的 SPI (Service Provider Interface) 扩展点发现机制加强而来。</p><p>Dubbo 改进了 JDK 标准的 SPI 的以下问题：</p><ul><li>JDK 标准的 SPI 会一次性实例化扩展点所有实现，如果有扩展实现初始化很耗时，但如果没用上也加载，会很浪费资源。</li><li>如果扩展点加载失败，连扩展点的名称都拿不到了。比如：JDK 标准的 ScriptEngine，通过 <code class="language-plaintext highlighter-rouge">getName()</code> 获取脚本类型的名称，但如果 RubyScriptEngine 因为所依赖的 jruby.jar 不存在，导致 RubyScriptEngine 类加载失败，这个失败原因被吃掉了，和 ruby 对应不起来，当用户执行 ruby 脚本时，会报不支持 ruby，而不是真正失败的原因。</li><li>增加了对扩展点 IoC 和 AOP 的支持，一个扩展点可以直接 setter 注入其它扩展点。</li></ul><p>约定：</p><p>在扩展类的 jar 包内，放置扩展点配置文件 <code class="language-plaintext highlighter-rouge">META-INF/dubbo/接口全限定名</code>，内容为：<code class="language-plaintext highlighter-rouge">配置名=扩展实现类全限定名</code>，多个实现类用换行符分隔。</p><p>例子：</p><p>以扩展 Dubbo 的协议为例，在协议的实现 jar 包内放置文本文件：<code class="language-plaintext highlighter-rouge">META-INF/dubbo/org.apache.dubbo.rpc.Protocol</code>，内容为：</p><pre><code class="language-fallback">xxx=com.alibaba.xxx.XxxProtocol
</code></pre><p>实现类内容</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">com.alibaba.xxx</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">org.apache.dubbo.rpc.Protocol</span><span class="o">;</span>
 
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">XxxProtocol</span> <span class="kd">implements</span> <span class="nc">Protocol</span> <span class="o">{</span> 
    <span class="c1">// ...</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>扩展点自动装配</strong></p><p>加载扩展点时，自动注入依赖的扩展点。<strong>加载扩展点时，扩展点实现类的成员如果为其它扩展点类型，<code class="language-plaintext highlighter-rouge">ExtensionLoader</code> 在会自动注入依赖的扩展点</strong>。<code class="language-plaintext highlighter-rouge">ExtensionLoader</code> 通过扫描扩展点实现类的所有 <strong>setter 方法</strong>来判定其成员。即 <code class="language-plaintext highlighter-rouge">ExtensionLoader</code> 会执行扩展点的拼装操作。</p><p>这里带来另一个问题，<code class="language-plaintext highlighter-rouge">ExtensionLoader</code> 要注入依赖扩展点时，如何决定要注入依赖扩展点的哪个实现。</p><p><strong>扩展点自适应</strong></p><p><code class="language-plaintext highlighter-rouge">ExtensionLoader</code> 注入的依赖扩展点是一个 <code class="language-plaintext highlighter-rouge">Adaptive</code> 实例，直到扩展点方法执行时才决定调用是哪一个扩展点实现。</p><p>Dubbo 使用 URL 对象（包含了Key-Value）传递配置信息。</p><p>扩展点方法调用会有URL参数（或是参数有URL成员）</p><p>这样依赖的扩展点也可以从URL拿到配置信息，所有的扩展点自己定好配置的Key后，配置信息从URL上从最外层传入。URL在配置传递上即是一条总线。</p><p>举个例子：假设有两个扩展点<code class="language-plaintext highlighter-rouge">CarMaker</code>，<code class="language-plaintext highlighter-rouge">WheelMaker</code></p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">CarMaker</span> <span class="o">{</span>
    <span class="nc">Car</span> <span class="nf">makeCar</span><span class="o">(</span><span class="no">URL</span> <span class="n">url</span><span class="o">);</span>
<span class="o">}</span>
 
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">WheelMaker</span> <span class="o">{</span>
    <span class="nc">Wheel</span> <span class="nf">makeWheel</span><span class="o">(</span><span class="no">URL</span> <span class="n">url</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">CarMaker</code> 的一个实现类：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">RaceCarMaker</span> <span class="kd">implements</span> <span class="nc">CarMaker</span> <span class="o">{</span>
    <span class="nc">WheelMaker</span> <span class="n">wheelMaker</span><span class="o">;</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setWheelMaker</span><span class="o">(</span><span class="nc">WheelMaker</span> <span class="n">wheelMaker</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">wheelMaker</span> <span class="o">=</span> <span class="n">wheelMaker</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="nc">Car</span> <span class="nf">makeCar</span><span class="o">(</span><span class="no">URL</span> <span class="n">url</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// ...</span>
        <span class="nc">Wheel</span> <span class="n">wheel</span> <span class="o">=</span> <span class="n">wheelMaker</span><span class="o">.</span><span class="na">makeWheel</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>
        <span class="c1">// ...</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">RaceCar</span><span class="o">(</span><span class="n">wheel</span><span class="o">,</span> <span class="o">...);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>那么扩展carMaker时，也会自动装配扩展wheelMaker。但是不是立即扩展，而是自适应扩展，只有当wheelMaker的方法被调用时，才会选择一个扩展点实现。即执行wheelMaker.makeWheel(url)时，才会根据方法的参数来选择扩展点实现，因为扩展点wheelMaker可能有多个实现。</p><p>我们可以通过Adaptive注解来指定实际的扩展点，如：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Transporter</span> <span class="o">{</span>
    <span class="nd">@Adaptive</span><span class="o">({</span><span class="s">"server"</span><span class="o">,</span> <span class="s">"transport"</span><span class="o">})</span>
    <span class="nc">Server</span> <span class="nf">bind</span><span class="o">(</span><span class="no">URL</span> <span class="n">url</span><span class="o">,</span> <span class="nc">ChannelHandler</span> <span class="n">handler</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">RemotingException</span><span class="o">;</span>
 
    <span class="nd">@Adaptive</span><span class="o">({</span><span class="s">"client"</span><span class="o">,</span> <span class="s">"transport"</span><span class="o">})</span>
    <span class="nc">Client</span> <span class="nf">connect</span><span class="o">(</span><span class="no">URL</span> <span class="n">url</span><span class="o">,</span> <span class="nc">ChannelHandler</span> <span class="n">handler</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">RemotingException</span><span class="o">;</span>
<span class="o">}</span>
</pre></table></code></div></div><p>对于 bind() 方法，Adaptive 实现先查找 <code class="language-plaintext highlighter-rouge">server</code> key，如果该 Key 没有值则找 <code class="language-plaintext highlighter-rouge">transport</code> key 值，来决定代理到哪个实际扩展点。</p><h2 id="dubbo的实现细节">Dubbo的实现细节</h2><h3 id="初始化过程的细节">初始化过程的细节</h3><p>解析服务：</p><ul><li>基于 dubbo.jar 内的 <code class="language-plaintext highlighter-rouge">META-INF/spring.handlers</code> 配置，Spring 在遇到 dubbo 名称空间时，会回调 <code class="language-plaintext highlighter-rouge">DubboNamespaceHandler</code>。</li><li>所有 dubbo 的标签，都统一用 <code class="language-plaintext highlighter-rouge">DubboBeanDefinitionParser</code> 进行解析，<strong>基于一对一属性映射，将 XML 标签解析为 Bean 对象。</strong></li><li>在 <code class="language-plaintext highlighter-rouge">ServiceConfig.export()</code> 或 <code class="language-plaintext highlighter-rouge">ReferenceConfig.get()</code> 初始化时，将 Bean 对象转换 URL 格式，所有 Bean 属性转成 URL 的参数。</li><li>然后将 URL 传给 协议扩展点，基于扩展点的扩展点自适应机制，根据 URL 的协议头，进行不同协议的服务暴露或引用。</li></ul><p>暴露服务：</p><ul><li>只暴露在服务端口：在没有注册中心，直接暴露提供者的情况下，ServiceConfig解析出的URL的格式为：<code class="language-plaintext highlighter-rouge">dubbo://service-host/com.foo.FooService?version=1.0.0</code>。基于扩展点自适应机制，通过URL的<code class="language-plaintext highlighter-rouge">dubbo://</code>协议头识别，直接调用<code class="language-plaintext highlighter-rouge">DubboProtocol</code>的export方法，打开服务端口。</li><li>向注册中心暴露服务：在有注册中心，需要注册提供者地址的情况下，<code class="language-plaintext highlighter-rouge">ServiceConfig</code>解析出的URL的格式为：<code class="language-plaintext highlighter-rouge">registry://registry-host/org.apache.dubbo.registry.RegistryService?export=URL.encode("dubbo://service-host/com.foo.FooService?version=1.0.0")</code>。基于扩展点自适应机制，通过URL的<code class="language-plaintext highlighter-rouge">registry://</code>协议头识别，就会调用<code class="language-plaintext highlighter-rouge">RegistryProtocol</code>的<code class="language-plaintext highlighter-rouge">export</code>方法，将<code class="language-plaintext highlighter-rouge">export</code>参数中的提供者URL，先注册到注册中心。</li></ul><p>引用服务：</p><ul><li>在没有注册中心，直连提供者的情况下，<code class="language-plaintext highlighter-rouge">RefernceConfig</code>解析出的URL的格式为：<code class="language-plaintext highlighter-rouge">dubbo://service-host/com.foo.FooService?version=1.0.0</code>。基于自适应机制，通过URL的<code class="language-plaintext highlighter-rouge">dubbo://</code>协议头识别，直接调用<code class="language-plaintext highlighter-rouge">DubboProtocol</code>的refer方法，返回提供者引用。</li><li>在有注册中心，通过注册中心发现提供者地址的情况下 <a href="https://dubbo.apache.org/zh/docs/v2.7/dev/implementation/#fn:4">4</a>，<code class="language-plaintext highlighter-rouge">ReferenceConfig</code> 解析出的 URL 的格式为： <code class="language-plaintext highlighter-rouge">registry://registry-host/org.apache.dubbo.registry.RegistryService?refer=URL.encode("consumer://consumer-host/com.foo.FooService?version=1.0.0")</code>。基于扩展点自适应机制，通过 URL 的 <code class="language-plaintext highlighter-rouge">registry://</code> 协议头识别，就会调用 <code class="language-plaintext highlighter-rouge">RegistryProtocol</code> 的 <code class="language-plaintext highlighter-rouge">refer()</code> 方法，基于 <code class="language-plaintext highlighter-rouge">refer</code> 参数中的条件，查询提供者 URL，如： <code class="language-plaintext highlighter-rouge">dubbo://service-host/com.foo.FooService?version=1.0.0</code>。基于扩展点自适应机制，通过提供者 URL 的 <code class="language-plaintext highlighter-rouge">dubbo://</code> 协议头识别，就会调用 <code class="language-plaintext highlighter-rouge">DubboProtocol</code> 的 <code class="language-plaintext highlighter-rouge">refer()</code> 方法，得到提供者引用。然后 <code class="language-plaintext highlighter-rouge">RegistryProtocol</code> 将多个提供者引用，通过 <code class="language-plaintext highlighter-rouge">Cluster</code> 扩展点，伪装成单个提供者引用返回。</li></ul><p>拦截服务：</p><ul><li>基于扩展点自适应机制，所有的<code class="language-plaintext highlighter-rouge">Protocol</code>扩展点都会自动套上<code class="language-plaintext highlighter-rouge">Wrapper</code>类。</li><li>基于<code class="language-plaintext highlighter-rouge">ProtocolFilterWrapper</code>类，将所有<code class="language-plaintext highlighter-rouge">Filter</code>组装成链，在链的最后一节调用真实的引用。</li><li>基于 <code class="language-plaintext highlighter-rouge">ProtocolListenerWrapper</code> 类，将所有 <code class="language-plaintext highlighter-rouge">InvokerListener</code> 和 <code class="language-plaintext highlighter-rouge">ExporterListener</code> 组装集合，在暴露和引用前后，进行回调。</li><li>包括监控在内，所有附加功能，全部通过 <code class="language-plaintext highlighter-rouge">Filter</code> 拦截实现。</li></ul><h3 id="远程调用细节">远程调用细节</h3><p>服务提供者暴露一个服务的详细过程：</p><ol><li>首先 <code class="language-plaintext highlighter-rouge">ServiceConfig</code> 类拿到对外提供服务的实际类 ref(如：HelloWorldImpl)</li><li>然后通过 <code class="language-plaintext highlighter-rouge">ProxyFactory</code> 类的 <code class="language-plaintext highlighter-rouge">getInvoker</code> 方法使用 ref 生成一个 <code class="language-plaintext highlighter-rouge">AbstractProxyInvoker</code> 实例，到这一步就完成具体服务到 <code class="language-plaintext highlighter-rouge">Invoker</code> 的转化。接下来就是 <code class="language-plaintext highlighter-rouge">Invoker</code> 转换到 <code class="language-plaintext highlighter-rouge">Exporter</code> 的过程。</li><li>Dubbo 处理服务暴露的关键就在 <code class="language-plaintext highlighter-rouge">Invoker</code> 转换到 <code class="language-plaintext highlighter-rouge">Exporter</code> 的过程：<ol><li>Dubbo 协议的 <code class="language-plaintext highlighter-rouge">Invoker</code> 转为 <code class="language-plaintext highlighter-rouge">Exporter</code> 发生在 <code class="language-plaintext highlighter-rouge">DubboProtocol</code> 类的 <code class="language-plaintext highlighter-rouge">export</code> 方法，它主要是打开 socket 侦听服务，并接收客户端发来的各种请求，通讯细节由 Dubbo 自己实现。</li><li>RMI 协议的 <code class="language-plaintext highlighter-rouge">Invoker</code> 转为 <code class="language-plaintext highlighter-rouge">Exporter</code> 发生在 <code class="language-plaintext highlighter-rouge">RmiProtocol</code>类的 <code class="language-plaintext highlighter-rouge">export</code> 方法，它通过 Spring 或 Dubbo 或 JDK 来实现 RMI 服务，通讯细节这一块由 JDK 底层来实现，这就省了不少工作量。</li></ol></li></ol><p>服务消费者消费一个服务的详细过程：</p><ol><li>首先 <code class="language-plaintext highlighter-rouge">ReferenceConfig</code> 类的 <code class="language-plaintext highlighter-rouge">init</code> 方法调用 <code class="language-plaintext highlighter-rouge">Protocol</code> 的 <code class="language-plaintext highlighter-rouge">refer</code> 方法生成 <code class="language-plaintext highlighter-rouge">Invoker</code> 实例(如上图中的红色部分)，这是服务消费的关键。接下来把 <code class="language-plaintext highlighter-rouge">Invoker</code> 转换为客户端需要的接口(如：HelloWorld)。</li></ol><h3 id="满眼都是invoker">满眼都是Invoker</h3><p>说实在的，Dubbo的设计中，大多数类都是向Invoker靠拢，所以Invoker在源码中到处都是，整得我头晕眼花。这里梳理一下最重要的两个Invoker概念：</p><ol><li>服务提供者Invoker，Dubbo会把某个服务接口的实现类封装成AbstractProxyInvoker实例，然后通过某种协议Exporter出去，所以AbstractProxyInvoker就是服务提供者端的Invoker。</li><li>服务消费者Invoker，服务消费者会通过Reference获得远程服务的代理对象proxy，proxy会根据协议调用Invoker，在这个Invoker中实现了真正的远程服务调用，这个Invoker就是服务消费者端的Invoker。</li></ol><h3 id="远程通讯细节">远程通讯细节</h3><p>协议头约定</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://hyc-pic.oss-cn-hangzhou.aliyuncs.com/image-20210607163647136.png" alt="image-20210607163647136" /></p><ul><li>魔数：0xdabb</li><li>Req/Res(1 bit)：标识这个是请求还是响应，1为请求，0为响应。</li><li>2 Way(1 bit)：只有是请求时才有效，置1标识需要服务端返回值。</li><li>Event(1 bit)：置1标识这个是一个事件消息，比如心跳事件。</li><li>Serialization ID(5 bits)：标识序列化类型，比如fastjson的值为6。</li><li>Status(8 bits)：只有是响应是才有效，标识响应的状态：<ul><li>20 - OK</li><li>30 - CLIENT_TIMEOUT</li><li>31 - SERVER_TIMEOUT</li><li>40 - BAD_REQUEST</li><li>50 - BAD_RESPONSE</li><li>60 - SERVICE_NOT_FOUND</li><li>70 - SERVICE_ERROR</li><li>80 - SERVER_ERROR</li><li>90 - CLIENT_ERROR</li><li>100 - SERVER_THREADPOOL_EXHAUSTED_ERROR</li></ul></li><li>Request ID(64 bits)：标识一个唯一的请求，Numeric(long)类型。</li><li>Data Length(32 bits)：序列化后内容的长度，内容单位是字节，Numeric(Integer)。</li><li>Variable Part：有多个部分，每个部分都是根据具体的序列化类型序列化后的数据，由Serialization ID标识。<ul><li>如果内容是请求，每个部分由以下内容组成（从上到下的顺序）：<ul><li>Dubbo版本</li><li>服务名称</li><li>服务版本</li><li>方法名称</li><li>方法参数类型</li><li>方法参数</li><li>附件</li></ul></li><li>如果内容是响应，每个部分由以下内容组成（从上到下的顺序）：<ul><li>返回值类型，标识服务端返回的数据是何种类型的：<ul><li>RESPONSE_NULL_VALUE - 2</li><li>RESPONSE_VALUE - 1</li><li>RESPONSE_WITH_EXCEPTION - 0</li></ul></li><li>服务端的返回值</li></ul></li></ul></li></ul><p>注意：对于(Variable Part)变长部分，当前版本的dubbo框架使用json序列化时，在每部分内容间额外增加了换行符作为分隔，请在Variable Part的每个part后额外增加换行符。</p><h2 id="spi扩展实现">SPI扩展实现</h2><h3 id="协议扩展">协议扩展</h3><p>RPC 协议扩展，封装远程调用细节。</p><p>契约：</p><ul><li>服务消费者调用refer方法，返回一个Invoker对象，随即调用invoke方法，协议需要执行同URL远端export传入的Invoke对象的invoke方法。</li><li>其中，refer返回的Invoker由协议实现，协议需要在此Invoker中发送远程请求，export传入的Invoker由框架实现并传入，协议不用关心。</li></ul><p>事实上，协议并不关心业务接口的透明代理，以Invoker为中心，由外层将Invoker转换为业务接口。</p><p>协议不一定需要通过网络，主机内的IPC也是可以的，比如共享内存区、消息队列等。</p><p>扩展的接口</p><ul><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.rpc.Protocol</code></li><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.rpc.Exporter</code></li><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.rpc.Invoker</code></li></ul><p>接口Protocol中的 两个关键方法：</p><ul><li>export：用于暴露远程服务<ul><li>协议在接收请求时，应记录请求来源方地址信息：RpcContext.getContext().setRemoteAddress();</li><li>export()必须是幂等的，也就是暴露同一个URL的Invoker两次，和暴露一次没有区别。</li><li>export()传入的Invoker由框架实现并传入，协议不需要关心。</li></ul></li><li>refer：用于引用远程服务<ul><li>当用户调用refer()所返回的Invoker对象的invoke()方法时，协议需相应执行同URL远端export()传入的Invoker对象的invoke()方法。</li><li>refer()返回的Invoker由协议实现，协议通常需要在此Invoker中发送远程请求。</li><li>当url中有设置check=false时，连接失败不能抛出异常，需内部自动恢复。</li></ul></li></ul><p>Protocol的扩展：</p><ul><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.rpc.protocol.injvm.InjvmProtocol</code></li><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.rpc.protocol.dubbo.DubboProtocol</code></li><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.rpc.protocol.rmi.RmiProtocol</code></li><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.rpc.protocol.http.HttpProtocol</code></li><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.rpc.protocol.http.hessian.HessianProtocol</code></li></ul><h3 id="调用拦截扩展">调用拦截扩展</h3><p>此扩展用于在服务提供方和服务消费方调用链路上进行拦截，Dubbo的大多数功能都是基于此扩展点实现的，每次执行远程方法，都会执行拦截，但是需要关注对性能的影响，因为过多的拦截势必会降低响应速度。</p><p>约定：</p><ul><li>用户自定义 filter 默认在内置 filter 之后。</li><li>特殊值 <code class="language-plaintext highlighter-rouge">default</code>，表示缺省扩展点插入的位置。比如：<code class="language-plaintext highlighter-rouge">filter="xxx,default,yyy"</code>，表示 <code class="language-plaintext highlighter-rouge">xxx</code> 在缺省 filter 之前，<code class="language-plaintext highlighter-rouge">yyy</code> 在缺省 filter 之后。</li><li>特殊符号 <code class="language-plaintext highlighter-rouge">-</code>，表示剔除。比如：<code class="language-plaintext highlighter-rouge">filter="-foo1"</code>，剔除添加缺省扩展点 <code class="language-plaintext highlighter-rouge">foo1</code>。比如：<code class="language-plaintext highlighter-rouge">filter="-default"</code>，剔除添加所有缺省扩展点。</li><li>provider 和 service 同时配置的 filter 时，<strong>累加所有 filter，而不是覆盖</strong>。比如：<code class="language-plaintext highlighter-rouge">&lt;dubbo:provider filter="xxx,yyy"/&gt;</code> 和 <code class="language-plaintext highlighter-rouge">&lt;dubbo:service filter="aaa,bbb" /&gt;</code>，则 <code class="language-plaintext highlighter-rouge">xxx</code>,<code class="language-plaintext highlighter-rouge">yyy</code>,<code class="language-plaintext highlighter-rouge">aaa</code>,<code class="language-plaintext highlighter-rouge">bbb</code> 均会生效。如果要覆盖，需配置：<code class="language-plaintext highlighter-rouge">&lt;dubbo:service filter="-xxx,-yyy,aaa,bbb" /&gt;</code></li></ul><p>扩展的接口：</p><p><code class="language-plaintext highlighter-rouge">org.apache.dubbo.rpc.Filter</code></p><p>配置方式：</p><div class="language-xml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="c">&lt;!-- 消费方调用过程拦截 --&gt;</span>
<span class="nt">&lt;dubbo:reference</span> <span class="na">filter=</span><span class="s">"xxx,yyy"</span> <span class="nt">/&gt;</span>
<span class="c">&lt;!-- 消费方调用过程缺省拦截器，将拦截所有reference --&gt;</span>
<span class="nt">&lt;dubbo:consumer</span> <span class="na">filter=</span><span class="s">"xxx,yyy"</span><span class="nt">/&gt;</span>
<span class="c">&lt;!-- 提供方调用过程拦截 --&gt;</span>
<span class="nt">&lt;dubbo:service</span> <span class="na">filter=</span><span class="s">"xxx,yyy"</span> <span class="nt">/&gt;</span>
<span class="c">&lt;!-- 提供方调用过程缺省拦截器，将拦截所有service --&gt;</span>
<span class="nt">&lt;dubbo:provider</span> <span class="na">filter=</span><span class="s">"xxx,yyy"</span><span class="nt">/&gt;</span>
</pre></table></code></div></div><p>Filter的扩展：</p><ul><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.rpc.filter.EchoFilter</code></li><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.rpc.filter.GenericFilter</code></li><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.rpc.filter.GenericImplFilter</code></li><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.rpc.filter.TokenFilter</code></li><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.rpc.filter.AccessLogFilter</code></li><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.rpc.filter.CountFilter</code></li><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.rpc.filter.ActiveLimitFilter</code></li><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.rpc.filter.ClassLoaderFilter</code></li><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.rpc.filter.ContextFilter</code></li><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.rpc.filter.ConsumerContextFilter</code></li><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.rpc.filter.ExceptionFilter</code></li><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.rpc.filter.ExecuteLimitFilter</code></li><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.rpc.filter.DeprecatedFilter</code></li></ul><h3 id="引用监听扩展">引用监听扩展</h3><p>当有服务引用时，触发该事件。</p><p>接口：</p><p><code class="language-plaintext highlighter-rouge">org.apache.dubbo.rpc.InvokerListener</code></p><p>扩展实现：</p><p><code class="language-plaintext highlighter-rouge">org.apache.dubbo.rpc.listener.DeprecatedInvokerListener</code></p><h3 id="暴露监听扩展">暴露监听扩展</h3><p>当有服务暴露时，触发该事件。</p><p>接口：</p><p><code class="language-plaintext highlighter-rouge">org.apache.dubbo.rpc.ExporterListener</code></p><p>扩展实现：</p><p><code class="language-plaintext highlighter-rouge">org.apache.dubbo.registry.directory.RegistryExporterListener</code></p><h3 id="集群扩展">集群扩展</h3><p>当有多个服务提供者时，将多个服务提供方组织成一个集群，并伪装成一个提供者。</p><p>接口：</p><p><code class="language-plaintext highlighter-rouge">org.apache.dubbo.rpc.cluster.Cluster</code></p><p>扩展实现：</p><ul><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.rpc.cluster.support.FailoverCluster</code></li><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.rpc.cluster.support.FailfastCluster</code></li><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.rpc.cluster.support.FailsafeCluster</code></li><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.rpc.cluster.support.FailbackCluster</code></li><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.rpc.cluster.support.ForkingCluster</code></li><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.rpc.cluster.support.AvailableCluster</code></li></ul><h3 id="路由扩展">路由扩展</h3><p>从多个服务提供方中选择一个进行调用。</p><p>接口：</p><ul><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.rpc.cluster.RouterFactory</code></li><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.rpc.cluster.Router</code></li></ul><p>扩展实现：</p><ul><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.rpc.cluster.router.ScriptRouterFactory</code></li><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.rpc.cluster.router.FileRouterFactory</code></li><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.rpc.cluster.router.condition.config.AppRouterFactory</code></li><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.rpc.cluster.CacheableRouterFactory</code></li><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.rpc.cluster.router.condition.ConditionRouterFactory</code></li><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.rpc.cluster.router.mock.MockRouterFactory</code></li><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.rpc.cluster.router.condition.config.ServiceRouterFactory</code></li><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.rpc.cluster.router.tag.TagRouterFactory</code></li></ul><h3 id="负载均衡扩展">负载均衡扩展</h3><p>从多个服务提供者中选择一个进行调用。</p><p>接口：</p><p><code class="language-plaintext highlighter-rouge">org.apache.dubbo.rpc.cluster.LoadBalance</code></p><p>扩展实现：</p><ul><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.rpc.cluster.loadbalance.RandomLoadBalance</code></li><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.rpc.cluster.loadbalance.RoundRobinLoadBalance</code></li><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.rpc.cluster.loadbalance.LeastActiveLoadBalance</code></li></ul><h3 id="注册中心扩展">注册中心扩展</h3><p>负责服务的注册与发现。</p><p>扩展接口：</p><ul><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.registry.RegistryFactory</code></li><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.registry.Registry</code></li></ul><p>扩展实现：</p><p><code class="language-plaintext highlighter-rouge">org.apache.dubbo.registry.support.dubbo.DubboRegistryFactory</code></p><h3 id="监控中心扩展">监控中心扩展</h3><p>负责服务调用次和调用时间的监控。</p><p>接口：</p><ul><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.monitor.MonitorFactory</code></li><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.monitor.Monitor</code></li></ul><p>扩展实现：</p><p><code class="language-plaintext highlighter-rouge">org.apache.dubbo.monitor.support.dubbo.DubboMonitorFactory</code></p><h3 id="动态代理扩展">动态代理扩展</h3><p>将Invoker转换为业务接口</p><p>接口：</p><p><code class="language-plaintext highlighter-rouge">org.apache.dubbo.rpc.ProxyFactory</code></p><p>扩展实现：</p><ul><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.rpc.proxy.JdkProxyFactory</code></li><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.rpc.proxy.JavassistProxyFactory</code></li></ul><h3 id="线程池扩展">线程池扩展</h3><p>服务提供方线程池实现策略，当服务器收到一个请求时，需要在线程池中创建一个线程去执行服务提供方业务逻辑。</p><p>接口：</p><p><code class="language-plaintext highlighter-rouge">org.apache.dubbo.common.threadpool.ThreadPool</code></p><p>扩展实现：</p><ul><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.common.threadpool.FixedThreadPool</code></li><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.common.threadpool.CachedThreadPool</code></li></ul><h3 id="序列化扩展">序列化扩展</h3><p>将对象转成字节流，用于网络传输，以及将字节流转为对象，用于在收到字节流数据后还原成对象。</p><p>接口：</p><ul><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.common.serialize.Serialization</code></li><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.common.serialize.ObjectInput</code></li><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.common.serialize.ObjectOutput</code></li></ul><p>扩展实现：</p><ul><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.common.serialize.dubbo.DubboSerialization</code></li><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.common.serialize.hessian.Hessian2Serialization</code></li><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.common.serialize.java.JavaSerialization</code></li><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.common.serialize.java.CompactedJavaSerialization</code></li></ul><h3 id="网络传输扩展">网络传输扩展</h3><p>远程通讯的服务器及客户端传输实现。</p><p>接口：</p><ul><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.remoting.Transporter</code></li><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.remoting.Server</code></li><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.remoting.Client</code></li></ul><p>扩展实现：</p><ul><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.remoting.transport.transporter.netty.NettyTransporter</code></li><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.remoting.transport.transporter.mina.MinaTransporter</code></li><li><code class="language-plaintext highlighter-rouge">org.apache.dubbo.remoting.transport.transporter.grizzly.GrizzlyTransporter</code></li></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/blogging/'>Blogging</a>, <a href='/categories/javaweb/'>Javaweb</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/web/" class="post-tag no-text-decoration" >web</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><!-- Post sharing snippet v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT License --><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Dubbo文档阅读笔记-设计 - 黄玉才的博客&url=www.yucaihuang.com/posts/dubbo-doc-2/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Dubbo文档阅读笔记-设计 - 黄玉才的博客&u=www.yucaihuang.com/posts/dubbo-doc-2/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Dubbo文档阅读笔记-设计 - 黄玉才的博客&url=www.yucaihuang.com/posts/dubbo-doc-2/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><!-- The Pannel on right side (Desktop views) v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><h3 data-toc-skip>Recent Update</h3><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/web-url-with-chinese-string/">URL包含中文，请求资源404</a></li><li><a href="/posts/web-docker_2/">Docker：入门</a></li><li><a href="/posts/web-docker_1/">Docker：概述</a></li><li><a href="/posts/web-delete-system-python-in-centos/">centOS误删系统自带python</a></li><li><a href="/posts/springboot-starter-id/">创建自定义Springboot starter</a></li></ul></div><div id="access-tags"><h3 data-toc-skip>Trending Tags</h3><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/%E7%AE%97%E6%B3%95%E9%A2%98%E8%A7%A3/">算法题解</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/java%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/">Java源码学习</a> <a class="post-tag" href="/tags/jvm/">jvm</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/security/">security</a> <a class="post-tag" href="/tags/algorithms/">Algorithms</a> <a class="post-tag" href="/tags/redis/">redis</a> <a class="post-tag" href="/tags/concurrency/">concurrency</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><h3 data-toc-skip class="pl-3 pt-2 mb-2">Contents</h3><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <!-- Recommend the other 3 posts according to the tags and categories of the current post, if the number is not enough, use the other latest posts to supplement. v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT License --><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/web-javaweb-mybatis_1/"><div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago small" > Sep 4, 2020 <i class="unloaded">2020-09-04T19:17:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Mybatis：环境搭建</h3><div class="text-muted small"><p> 创建maven工程并导入坐标： &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.mybatis&lt;/groupId&gt; &lt;artifactId&gt;mybatis&lt;/artifactId&gt; ...</p></div></div></a></div><div class="card"> <a href="/posts/web-javaweb-mybatis_2/"><div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago small" > Sep 4, 2020 <i class="unloaded">2020-09-04T19:18:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Mybatis：入门</h3><div class="text-muted small"><p> 入门案例 public class MybatisTest { public static void main(String[] args) throws IOException { //1.读取配置文件 InputStream in = Resources.getResourceAsStream("SqlMapConfig.xml"); ...</p></div></div></a></div><div class="card"> <a href="/posts/web-javaweb-mybatis_3/"><div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago small" > Sep 4, 2020 <i class="unloaded">2020-09-04T19:19:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Mybatis：CRUD</h3><div class="text-muted small"><p> 保存操作 在用户Dao接口中定义saveUser抽象方法，用于保存用户： package com.hyc.dao; import com.hyc.domain.User; import org.apache.ibatis.annotations.Select; import java.util.List; /** * 用户的持久层接口 */ public interface I...</p></div></div></a></div></div></div><!-- Navigation buttons at the bottom of the post. v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --><div class="post-navigation d-flex justify-content-between"> <a href="/posts/dubbo-doc-1/" class="btn btn-outline-primary"><p>Dubbo文档阅读笔记-用法</p></a> <span class="btn btn-outline-primary disabled"><p>-</p></span></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script> <!-- The Footer v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><footer class="d-flex w-100 justify-content-center"><p class="footer-center"> © 2021 <a href="">Yucai Huang</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span> <br> <a href="https://beian.miit.gov.cn/" target="_blank">浙ICP备2020032055号-2</a></p></footer></div><!-- The Search results v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/%E7%AE%97%E6%B3%95%E9%A2%98%E8%A7%A3/">算法题解</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/java%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/">Java源码学习</a> <a class="post-tag" href="/tags/jvm/">jvm</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/security/">security</a> <a class="post-tag" href="/tags/algorithms/">Algorithms</a> <a class="post-tag" href="/tags/redis/">redis</a> <a class="post-tag" href="/tags/concurrency/">concurrency</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <!-- The GA snippet v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-176388509-1', 'auto'); ga('send', 'pageview'); </script> <script> (function(e,t,n,i,s,a,c){e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)} ;a=t.createElement(i);c=t.getElementsByTagName(i)[0];a.async=true;a.src=s ;c.parentNode.insertBefore(a,c) })(window,document,"galite","script","https://cdn.jsdelivr.net/npm/ga-lite@2/dist/ga-lite.min.js"); galite('create', '{"id"=>"UA-176388509-1", "pv"=>{"enabled"=>false, "proxy_url"=>"", "proxy_endpoint"=>"", "cache"=>true}}', 'auto'); galite('send', 'pageview'); </script> <!-- Jekyll Simple Search loader v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="www.yucaihuang.com{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
